{% extends 'core/base.html' %}
{% load static %}

{% block title %}{{ tour.title }} - Tour Details{% endblock %}

{% block content %}
<div class="tour-detail-header">
    <a href="{% url 'tours' %}" class="back-link">← Back to Tours</a>
    <h1>{{ tour.title }}</h1>
</div>

<!-- Departure Dates Management -->
<div class="tour-departures-section">
    <h2>Departure Dates</h2>
    <form method="post" class="add-departure-form" style="margin-bottom: 1em;">
        {% csrf_token %}
        <input type="date" name="departure_date" required>
        <button type="submit" name="add_departure" class="btn btn-primary">Add Departure</button>
    </form>
    <ul class="departure-dates-list">
        {% for dep in departures %}
        <li>
            {{ dep.departure_date|date:"F d, Y" }}
            <form method="post" style="display:inline;">
                {% csrf_token %}
                <input type="hidden" name="delete_departure" value="{{ dep.id }}">
                <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Delete this departure date?');">Delete</button>
            </form>
        </li>
        {% empty %}
        <li>No departures yet for this tour.</li>
        {% endfor %}
    </ul>
</div>

<div class="tour-detail-container">
    <!-- Tour Overview -->
    <div class="tour-overview">
        {% if tour.image %}
            <div class="tour-hero-image">
                <img src="{{ tour.image.url }}" alt="{{ tour.title }}">
            </div>
        {% elif tour.image_url %}
            <div class="tour-hero-image">
                <img src="{{ tour.image_url }}" alt="{{ tour.title }}">
            </div>
        {% endif %}
        <div class="tour-meta">
            <div class="tour-meta-item">
                <span class="meta-label">Destination:</span>
                <span class="meta-value">{{ tour.destination }}</span>
            </div>
            <div class="tour-meta-item">
                <span class="meta-label">Duration:</span>
                <span class="meta-value">{{ tour.duration_days }} days</span>
            </div>
            <div class="tour-meta-item">
                <span class="meta-label">Price:</span>
                <span class="meta-value price">
                    {% if tour.pricing_type == 'per_person' %}
                        £{{ tour.price_per_person|floatformat:0 }} PPP
                    {% else %}
                        £{{ tour.price_per_group|floatformat:0 }} Group
                    {% endif %}
                </span>
            </div>
            <div class="tour-meta-item">
                <span class="meta-label">Difficulty:</span>
                <span class="meta-value difficulty {{ tour.difficulty_level }}">{{ tour.get_difficulty_level_display }}</span>
            </div>
            <div class="tour-meta-item">
                <span class="meta-label">Max Group Size:</span>
                <span class="meta-value">{{ tour.max_group_size }} people</span>
            </div>
        </div>
    </div>

    <!-- Tour Description -->
    <div class="tour-section">
        <h2>Tour Description</h2>
        <div class="tour-description-full">
            {{ tour.description|linebreaks }}
        </div>
    </div>

    <!-- Tour Highlights -->
    <div class="tour-section">
        <h2>Highlights</h2>
        <div class="tour-highlights">
            {{ tour.highlights|linebreaks }}
        </div>
    </div>

    <!-- What's Included -->
    <div class="tour-section">
        <h2>What's Included</h2>
        <div class="tour-included">
            {{ tour.included_services|linebreaks }}
        </div>
    </div>

    <!-- What's Not Included -->
    {% if tour.excluded_services %}
    <div class="tour-section">
        <h2>What's Not Included</h2>
        <div class="tour-excluded">
            {{ tour.excluded_services|linebreaks }}
        </div>
    </div>
    {% endif %}

    <!-- Tour Details -->
    <div class="tour-section">
        <h2>Additional Information</h2>
        <div class="tour-additional">
            <p><strong>Created:</strong> {{ tour.created_date|date:"F d, Y" }}</p>
            <p><strong>Tour ID:</strong> {{ tour.id }}</p>
        </div>
    </div>
</div>
{% endblock %} 