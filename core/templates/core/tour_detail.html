{% extends 'core/base.html' %}
{% load static %}

{% block title %}{{ tour.title }} - Tour Details{% endblock %}

{% block extra_css %}
<link rel="stylesheet" type="text/css" href="{% static 'core/css/tour_detail.css' %}">
{% endblock %}

{% block content %}
<div class="tour-detail-header">
    <div class="header-left">
        <a href="{% url 'tours' %}" class="back-link">‚Üê Back to Tours</a>
        <h1>{{ tour.title }}</h1>
    </div>
    <div class="header-actions">
        <a href="{% url 'edit_tour' tour.id %}" class="btn btn-edit">
            ‚úèÔ∏è Edit Tour
        </a>
        <a href="{% url 'delete_tour' tour.id %}" class="btn btn-delete">
            üóëÔ∏è Delete Tour
        </a>
    </div>
</div>

<!-- Departure Dates Management -->
<div class="tour-departures-section">
    <div class="section-header">
        <h2>Departure Dates</h2>
        <a href="{% url 'create_departure' %}?tour_id={{ tour.id }}" class="btn btn-primary">Add New Departure</a>
    </div>
    
    {% if departures %}
    <div class="departures-grid">
        {% for dep in departures %}
        <div class="departure-card">
            <div class="departure-date">{{ dep.departure_date|date:"F d, Y" }}</div>
            <div class="departure-status">
                <span class="status-badge status-{{ dep.status }}">{{ dep.get_status_display }}</span>
            </div>
            <div class="departure-info">
                <div class="info-item">
                    <span class="label">Bookings:</span>
                    <span class="value">{{ dep.total_bookings }}/{{ dep.available_spots }}</span>
                </div>
                <div class="info-item">
                    <span class="label">Price:</span>
                    <span class="value">${{ dep.current_price_per_person|floatformat:2 }}</span>
                </div>
                {% if dep.breakeven_passengers %}
                <div class="info-item">
                    <span class="label">Breakeven:</span>
                    <span class="value {% if dep.total_bookings >= dep.breakeven_passengers %}achieved{% else %}pending{% endif %}">
                        {{ dep.breakeven_passengers }} passengers
                    </span>
                </div>
                {% endif %}
            </div>
            <div class="departure-actions">
                <a href="{% url 'edit_departure' dep.id %}" class="btn btn-sm btn-outline">Edit</a>
                <a href="{% url 'departure_detail' dep.id %}" class="btn btn-sm btn-primary">View Details</a>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="no-departures">
        <p>No departures scheduled for this tour yet.</p>
        <a href="{% url 'create_departure' %}?tour_id={{ tour.id }}" class="btn btn-primary">Create First Departure</a>
    </div>
    {% endif %}
</div>

<div class="tour-detail-container">
    <!-- Tour Overview -->
    <div class="tour-overview">
        {% if tour.image %}
            <div class="tour-hero-image">
                <img src="{{ tour.image.url }}" alt="{{ tour.title }}">
            </div>
        {% elif tour.image_url %}
            <div class="tour-hero-image">
                <img src="{{ tour.image_url }}" alt="{{ tour.title }}">
            </div>
        {% endif %}
        <div class="tour-meta">
            <div class="tour-meta-item">
                <span class="meta-label">Destination:</span>
                <span class="meta-value">{{ tour.destination }}</span>
            </div>
            <div class="tour-meta-item">
                <span class="meta-label">Duration:</span>
                <span class="meta-value">{{ tour.duration_days }} days</span>
            </div>
            <div class="tour-meta-item">
                <span class="meta-label">Price:</span>
                <span class="meta-value price">
                    {% if tour.pricing_type == 'per_person' %}
                        ¬£{{ tour.price_per_person|floatformat:0 }} PPP
                    {% else %}
                        ¬£{{ tour.price_per_group|floatformat:0 }} Group
                    {% endif %}
                </span>
            </div>
            <div class="tour-meta-item">
                <span class="meta-label">Difficulty:</span>
                <span class="meta-value difficulty {{ tour.difficulty_level }}">{{ tour.get_difficulty_level_display }}</span>
            </div>
            <div class="tour-meta-item">
                <span class="meta-label">Max Group Size:</span>
                <span class="meta-value">{{ tour.max_group_size }} people</span>
            </div>
        </div>
    </div>

    <!-- Tour Description -->
    <div class="tour-section">
        <h2>Tour Description</h2>
        <div class="tour-description-full">
            {{ tour.description|linebreaks }}
        </div>
    </div>

    <!-- Tour Highlights -->
    <div class="tour-section">
        <h2>Highlights</h2>
        <div class="tour-highlights">
            {{ tour.highlights|linebreaks }}
        </div>
    </div>

    <!-- What's Included -->
    <div class="tour-section">
        <h2>What's Included</h2>
        <div class="tour-included">
            {{ tour.included_services|linebreaks }}
        </div>
    </div>

    <!-- What's Not Included -->
    {% if tour.excluded_services %}
    <div class="tour-section">
        <h2>What's Not Included</h2>
        <div class="tour-excluded">
            {{ tour.excluded_services|linebreaks }}
        </div>
    </div>
    {% endif %}

    <!-- Tour Details -->
    <div class="tour-section">
        <h2>Additional Information</h2>
        <div class="tour-additional">
            <p><strong>Created:</strong> {{ tour.created_date|date:"F d, Y" }}</p>
            <p><strong>Tour ID:</strong> {{ tour.id }}</p>
        </div>
    </div>
</div>

{% endblock %} 