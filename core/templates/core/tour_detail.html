{% extends 'core/base.html' %}
{% load static %}

{% block title %}{{ tour.title }} - Tour Details{% endblock %}

{% block content %}
<div class="tour-detail-header">
    <div class="header-left">
        <a href="{% url 'tours' %}" class="back-link">‚Üê Back to Tours</a>
        <h1>{{ tour.title }}</h1>
    </div>
    <div class="header-actions">
        <a href="{% url 'edit_tour' tour.id %}" class="btn btn-edit">
            ‚úèÔ∏è Edit Tour
        </a>
        <a href="{% url 'delete_tour' tour.id %}" class="btn btn-delete">
            üóëÔ∏è Delete Tour
        </a>
    </div>
</div>

<!-- Departure Dates Management -->
<div class="tour-departures-section">
    <div class="section-header">
        <h2>Departure Dates</h2>
        <a href="{% url 'create_departure' %}?tour_id={{ tour.id }}" class="btn btn-primary">Add New Departure</a>
    </div>
    
    {% if departures %}
    <div class="departures-grid">
        {% for dep in departures %}
        <div class="departure-card">
            <div class="departure-date">{{ dep.departure_date|date:"F d, Y" }}</div>
            <div class="departure-status">
                <span class="status-badge status-{{ dep.status }}">{{ dep.get_status_display }}</span>
            </div>
            <div class="departure-info">
                <div class="info-item">
                    <span class="label">Bookings:</span>
                    <span class="value">{{ dep.total_bookings }}/{{ dep.available_spots }}</span>
                </div>
                <div class="info-item">
                    <span class="label">Price:</span>
                    <span class="value">¬£{{ dep.current_price_per_person|floatformat:2 }}</span>
                </div>
                {% if dep.breakeven_passengers %}
                <div class="info-item">
                    <span class="label">Breakeven:</span>
                    <span class="value {% if dep.total_bookings >= dep.breakeven_passengers %}achieved{% else %}pending{% endif %}">
                        {{ dep.breakeven_passengers }} passengers
                    </span>
                </div>
                {% endif %}
            </div>
            <div class="departure-actions">
                <a href="{% url 'edit_departure' dep.id %}" class="btn btn-sm btn-outline">Edit</a>
                <a href="{% url 'departure_detail' dep.id %}" class="btn btn-sm btn-primary">View Details</a>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="no-departures">
        <p>No departures scheduled for this tour yet.</p>
        <a href="{% url 'create_departure' %}?tour_id={{ tour.id }}" class="btn btn-primary">Create First Departure</a>
    </div>
    {% endif %}
</div>

<div class="tour-detail-container">
    <!-- Tour Overview -->
    <div class="tour-overview">
        {% if tour.image %}
            <div class="tour-hero-image">
                <img src="{{ tour.image.url }}" alt="{{ tour.title }}">
            </div>
        {% elif tour.image_url %}
            <div class="tour-hero-image">
                <img src="{{ tour.image_url }}" alt="{{ tour.title }}">
            </div>
        {% endif %}
        <div class="tour-meta">
            <div class="tour-meta-item">
                <span class="meta-label">Destination:</span>
                <span class="meta-value">{{ tour.destination }}</span>
            </div>
            <div class="tour-meta-item">
                <span class="meta-label">Duration:</span>
                <span class="meta-value">{{ tour.duration_days }} days</span>
            </div>
            <div class="tour-meta-item">
                <span class="meta-label">Price:</span>
                <span class="meta-value price">
                    {% if tour.pricing_type == 'per_person' %}
                        ¬£{{ tour.price_per_person|floatformat:0 }} PPP
                    {% else %}
                        ¬£{{ tour.price_per_group|floatformat:0 }} Group
                    {% endif %}
                </span>
            </div>
            <div class="tour-meta-item">
                <span class="meta-label">Difficulty:</span>
                <span class="meta-value difficulty {{ tour.difficulty_level }}">{{ tour.get_difficulty_level_display }}</span>
            </div>
            <div class="tour-meta-item">
                <span class="meta-label">Max Group Size:</span>
                <span class="meta-value">{{ tour.max_group_size }} people</span>
            </div>
        </div>
    </div>

    <!-- Tour Description -->
    <div class="tour-section">
        <h2>Tour Description</h2>
        <div class="tour-description-full">
            {{ tour.description|linebreaks }}
        </div>
    </div>

    <!-- Tour Highlights -->
    <div class="tour-section">
        <h2>Highlights</h2>
        <div class="tour-highlights">
            {{ tour.highlights|linebreaks }}
        </div>
    </div>

    <!-- What's Included -->
    <div class="tour-section">
        <h2>What's Included</h2>
        <div class="tour-included">
            {{ tour.included_services|linebreaks }}
        </div>
    </div>

    <!-- What's Not Included -->
    {% if tour.excluded_services %}
    <div class="tour-section">
        <h2>What's Not Included</h2>
        <div class="tour-excluded">
            {{ tour.excluded_services|linebreaks }}
        </div>
    </div>
    {% endif %}

    <!-- Tour Details -->
    <div class="tour-section">
        <h2>Additional Information</h2>
        <div class="tour-additional">
            <p><strong>Created:</strong> {{ tour.created_date|date:"F d, Y" }}</p>
            <p><strong>Tour ID:</strong> {{ tour.id }}</p>
        </div>
    </div>
</div>

<style>
/* Tour Detail Header */
.tour-detail-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 2rem;
    padding: 2rem;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 12px;
}

.header-left {
    flex: 1;
}

.back-link {
    color: rgba(255, 255, 255, 0.8);
    text-decoration: none;
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
    display: inline-block;
}

.back-link:hover {
    color: white;
    text-decoration: underline;
}

.tour-detail-header h1 {
    margin: 0;
    font-size: 2.5rem;
    font-weight: 700;
}

.header-actions {
    display: flex;
    gap: 1rem;
    margin-left: 2rem;
}

.btn {
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 600;
    text-decoration: none;
    cursor: pointer;
    transition: all 0.2s ease;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

.btn-edit {
    background: rgba(255, 255, 255, 0.2);
    color: white;
    border: 1px solid rgba(255, 255, 255, 0.3);
}

.btn-edit:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

.btn-delete {
    background: rgba(239, 68, 68, 0.8);
    color: white;
    border: 1px solid rgba(239, 68, 68, 0.9);
}

.btn-delete:hover {
    background: rgba(239, 68, 68, 1);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
}

@media (max-width: 768px) {
    .tour-detail-header {
        flex-direction: column;
        gap: 1rem;
    }
    
    .header-actions {
        margin-left: 0;
        justify-content: flex-start;
    }
    
    .tour-detail-header h1 {
        font-size: 2rem;
    }
}
</style>
{% endblock %} 