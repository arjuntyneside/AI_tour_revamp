{% extends 'core/base.html' %}
{% load static %}

{% block title %}Upload Documents{% endblock %}

{% block content %}
<h1>Upload Tour Documents</h1>

<!-- Django Messages -->
{% if messages %}
<div class="messages">
    {% for message in messages %}
    <div class="message {% if message.tags %}{{ message.tags }}{% endif %}">
        {{ message }}
    </div>
    {% endfor %}
</div>
{% endif %}

<div class="upload-section">
    <div class="upload-info">
        <h2>AI Document Processing</h2>
        <p>Upload your tour brochures, PDFs, or Excel files. Our AI will automatically extract:</p>
        <ul>
            <li>Tour titles and destinations</li>
            <li>Pricing information</li>
            <li>Duration and group sizes</li>
            <li>Included/excluded services</li>
            <li>Difficulty levels and highlights</li>
        </ul>
    </div>

    <div class="upload-form">
        <h3>Upload Document</h3>
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="form-group">
                <label for="document">Select File:</label>
                <input type="file" name="document" id="document" accept=".pdf,.docx,.xlsx,.xls,.txt" required>
                <small>Supported formats: PDF, DOCX, Excel, TXT (Max 10MB)</small>
            </div>
            
            <div class="form-group">
                <label for="file_name">File Name (optional):</label>
                <input type="text" name="file_name" id="file_name" placeholder="Enter a descriptive name">
            </div>
            
            <button type="submit" class="btn btn-primary">Upload Document</button>
        </form>
        
        <div class="workflow-info">
            <h4>Two-Step Process:</h4>
            <ol>
                <li><strong>Upload:</strong> Upload your document (this step)</li>
                <li><strong>Process:</strong> Go to Processing page and click "Process with AI"</li>
            </ol>
        </div>
    </div>
</div>

<hr>

<div class="recent-documents">
    <h2>Recent Documents</h2>
    {% if recent_documents %}
    <div class="documents-list">
        {% for document in recent_documents %}
        <div class="document-item">
            <div class="document-info">
                <h4>{{ document.file_name }}</h4>
                <p class="document-meta">
                    <span class="file-type">{{ document.file_type }}</span>
                    <span class="file-size">{{ document.file_size|filesizeformat }}</span>
                    <span class="upload-date">{{ document.uploaded_date|date:"M d, Y H:i" }}</span>
                </p>
                <div class="processing-status status-{{ document.processing_status }}">
                    <span class="status-badge">{{ document.get_processing_status_display }}</span>
                    {% if document.confidence_score %}
                        <span class="confidence">Confidence: {{ document.confidence_score }}%</span>
                    {% endif %}
                </div>
            </div>
            <div class="document-actions">
                {% if document.processing_status == 'completed' %}
                    <a href="#" class="btn btn-success">View Results</a>
                {% elif document.processing_status == 'failed' %}
                    <a href="#" class="btn btn-danger">View Errors</a>
                {% else %}
                    <span class="processing-indicator">Processing...</span>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="no-documents">
        <p>No documents uploaded yet. Start by uploading your first tour document above.</p>
    </div>
    {% endif %}
</div>

<style>
.upload-section {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2rem;
    margin-bottom: 2rem;
}

.upload-info {
    background: #f8f9fa;
    padding: 2rem;
    border-radius: 8px;
}

.upload-info h2 {
    color: #333;
    margin-bottom: 1rem;
}

.upload-info ul {
    margin-top: 1rem;
    padding-left: 1.5rem;
}

.upload-info li {
    margin-bottom: 0.5rem;
    color: #666;
}

.upload-form {
    background: white;
    padding: 2rem;
    border: 2px dashed #ddd;
    border-radius: 8px;
    text-align: center;
}

.upload-form h3 {
    margin-bottom: 1.5rem;
    color: #333;
}

.form-group {
    margin-bottom: 1.5rem;
    text-align: left;
}

.form-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: bold;
    color: #333;
}

.form-group input[type="file"] {
    width: 100%;
    padding: 1rem;
    border: 2px dashed #007bff;
    border-radius: 8px;
    background: #f8f9fa;
}

.form-group input[type="text"] {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid #ddd;
    border-radius: 4px;
}

.form-group small {
    color: #666;
    font-size: 0.875rem;
}

.workflow-info {
    margin-top: 1.5rem;
    padding: 1rem;
    background: #f8f9fa;
    border-radius: 6px;
    border-left: 4px solid #007bff;
    text-align: left;
}

.workflow-info h4 {
    margin: 0 0 0.5rem 0;
    color: #333;
}

.workflow-info ol {
    margin: 0;
    padding-left: 1.5rem;
}

.workflow-info li {
    margin-bottom: 0.25rem;
    color: #666;
}

.documents-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.document-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem;
    background: white;
    border: 1px solid #ddd;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.document-info h4 {
    margin: 0 0 0.5rem 0;
    color: #333;
}

.document-meta {
    margin: 0 0 1rem 0;
    color: #666;
    font-size: 0.875rem;
}

.document-meta span {
    margin-right: 1rem;
}

.processing-status {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.status-badge {
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: bold;
    text-transform: uppercase;
}

.status-pending .status-badge {
    background: #fff3cd;
    color: #856404;
}

.status-processing .status-badge {
    background: #cce5ff;
    color: #004085;
}

.status-completed .status-badge {
    background: #d4edda;
    color: #155724;
}

.status-failed .status-badge {
    background: #f8d7da;
    color: #721c24;
}

.confidence {
    font-size: 0.875rem;
    color: #666;
}

.processing-indicator {
    color: #007bff;
    font-style: italic;
}

.no-documents {
    text-align: center;
    padding: 3rem;
    background: #f8f9fa;
    border-radius: 8px;
    color: #666;
}

@media (max-width: 768px) {
    .upload-section {
        grid-template-columns: 1fr;
    }
    
    .document-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
    }
}
</style>
{% endblock %}
