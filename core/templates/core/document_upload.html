{% extends 'core/base.html' %}
{% load static %}

{% block title %}Upload Documents{% endblock %}

{% block extra_css %}
<link rel="stylesheet" type="text/css" href="{% static 'core/css/document_upload.css' %}">
{% endblock %}

{% block content %}
<h1>Upload Tour Documents</h1>

<!-- Django Messages -->
{% if messages %}
<div class="messages">
    {% for message in messages %}
    <div class="message {% if message.tags %}{{ message.tags }}{% endif %}">
        {{ message }}
    </div>
    {% endfor %}
</div>
{% endif %}

<div class="upload-section">
    <div class="upload-info">
        <h2>AI Document Processing</h2>
        <p>Upload your tour brochures, PDFs, or Excel files. Our AI will automatically extract:</p>
        <ul>
            <li>Tour titles and destinations</li>
            <li>Pricing information</li>
            <li>Duration and group sizes</li>
            <li>Included/excluded services</li>
            <li>Difficulty levels and highlights</li>
        </ul>
    </div>

    <div class="upload-form">
        <h3>Upload Document</h3>
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="form-group">
                <label for="document">Select File:</label>
                <input type="file" name="document" id="document" accept=".pdf,.docx,.xlsx,.xls,.txt" required>
                <small>Supported formats: PDF, DOCX, Excel, TXT (Max 10MB)</small>
            </div>
            
            <div class="form-group">
                <label for="file_name">File Name (optional):</label>
                <input type="text" name="file_name" id="file_name" placeholder="Enter a descriptive name">
            </div>
            
            <button type="submit" class="btn btn-primary">Upload Document</button>
        </form>
        
        <div class="workflow-info">
            <h4>Two-Step Process:</h4>
            <ol>
                <li><strong>Upload:</strong> Upload your document (this step)</li>
                <li><strong>Process:</strong> Go to Processing page and click "Process with AI"</li>
            </ol>
        </div>
    </div>
</div>

<hr>

<div class="recent-documents">
    <h2>Recent Documents</h2>
    {% if recent_documents %}
    <div class="documents-list">
        {% for document in recent_documents %}
        <div class="document-item">
            <div class="document-info">
                <h4>{{ document.file_name }}</h4>
                <p class="document-meta">
                    <span class="file-type">{{ document.file_type }}</span>
                    <span class="file-size">{{ document.file_size|filesizeformat }}</span>
                    <span class="upload-date">{{ document.uploaded_date|date:"M d, Y H:i" }}</span>
                </p>
                <div class="processing-status status-{{ document.processing_status }}">
                    <span class="status-badge">{{ document.get_processing_status_display }}</span>
                    {% if document.confidence_score %}
                        <span class="confidence">Confidence: {{ document.confidence_score }}%</span>
                    {% endif %}
                </div>
            </div>
            <div class="document-actions">
                {% if document.processing_status == 'completed' %}
                    <a href="#" class="btn btn-success">View Results</a>
                {% elif document.processing_status == 'failed' %}
                    <a href="#" class="btn btn-danger">View Errors</a>
                {% else %}
                    <span class="processing-indicator">Processing...</span>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="no-documents">
        <p>No documents uploaded yet. Start by uploading your first tour document above.</p>
    </div>
    {% endif %}
</div>

{% endblock %}
